<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Blackjack Trainer v2</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body {
    background: #034c2c;
    font-family: Arial, sans-serif;
    color: white;
    margin: 0;
    padding: 20px;
    text-align: center;
  }

  h1 { margin-top: 10px; }

  .table {
    background: #0a5a34;
    margin: 0 auto;
    padding: 20px;
    border-radius: 12px;
    max-width: 700px;
    box-shadow: 0 0 20px black;
  }

  .hand { 
    margin: 10px 0;
    display: flex;
    justify-content: center;
    gap: 10px;
  }

  .card {
    width: 60px;
    height: 90px;
    background: white;
    color: black;
    border-radius: 8px;
    border: 2px solid #ddd;
    box-shadow: 0 2px 6px rgba(0,0,0,0.5);
    padding: 5px;
    font-size: 20px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .red { color: red; }

  .label-line {
    font-size: 14px;
    margin-top: -4px;
    opacity: 0.85;
  }

  button {
    margin: 6px;
    padding: 10px 18px;
    border: none;
    border-radius: 6px;
    background: gold;
    color: black;
    font-weight: bold;
    cursor: pointer;
    font-size: 16px;
  }

  .rules {
    margin-top: 20px;
    background: rgba(0,0,0,0.2);
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
  }

  #rulesBody {
    max-height: 0;
    overflow: hidden;
    transition: max-height .3s ease;
    text-align: left;
  }

  #rulesBody.open {
    max-height: 500px;
    margin-top: 10px;
  }

  .plus {
    float: right;
    font-weight: bold;
    font-size: 22px;
  }
</style>
</head>

<body>

<h1>Blackjack Trainer</h1>

<div class="table">

  <h2>Dealer</h2>
  <div class="hand" id="dealerHand"></div>
  <p id="dealerTotal">Total: ?</p>

  <h2>You</h2>
  <div class="hand" id="playerHand"></div>
  <p id="playerTotal"></p>

  <p class="label-line" id="playerLabelLine"></p>

  <div>
    <button onclick="hit()">Hit</button>
    <button onclick="stand()">Stand</button>
    <button onclick="restart()">Restart</button>
  </div>

  <h3 id="result" style="height:20px; margin-top:10px;"></h3>

  <div id="rulesContainer" class="rules" style="display:none;" onclick="toggleRules()">
    <span><strong>+ Why This Was the Correct Strategy</strong></span>
    <span id="plusSign" class="plus">+</span>

    <div id="rulesBody">
      <div id="rulesText" style="padding:10px;"></div>
    </div>
  </div>

</div>

<script>
  const suits = ["♠","♥","♦","♣"];
  const values = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];

  let deck = [];
  let player = [];
  let dealer = [];
  let gameOver = false;
  let playerAction = null;

  function createDeck() {
    deck = [];
    for (let s of suits) {
      for (let v of values) {
        deck.push({suit:s, value:v});
      }
    }
    deck.sort(()=>Math.random() - 0.5);
  }

  function cardValue(c) {
    if (["J","Q","K"].includes(c.value)) return 10;
    if (c.value === "A") return 11;
    return parseInt(c.value);
  }

  function handTotal(hand) {
    let total = hand.reduce((sum,c)=>sum+cardValue(c),0);
    let aces = hand.filter(c=>c.value==="A").length;

    while (total>21 && aces>0) {
      total -= 10;
      aces--;
    }
    return total;
  }

  function dealInitial() {
    player = [deck.pop(), deck.pop()];
    dealer = [deck.pop(), deck.pop()];
    updateUI();
  }

  function renderCard(card) {
    const c = document.createElement("div");
    c.className = "card " + ((card.suit==="♥"||card.suit==="♦")?"red":"");
    c.innerHTML = `<div>${card.value}</div><div>${card.suit}</div>`;
    return c;
  }

  function updateUI() {
    // Dealer hand — only show first card
    const d = document.getElementById("dealerHand");
    d.innerHTML = "";
    d.appendChild(renderCard(dealer[0]));

    const hidden = document.createElement("div");
    hidden.className = "card";
    hidden.style.background = "black";
    hidden.style.color = "white";
    hidden.innerHTML = "";
    d.appendChild(hidden);

    document.getElementById("dealerTotal").innerText = "Total: ?";

    // Player hand
    const p = document.getElementById("playerHand");
    p.innerHTML = "";
    player.forEach(card => p.appendChild(renderCard(card)));

    // Label explaining which card the dealer sees
    document.getElementById("playerLabelLine").innerText =
      "Dealer sees: " + player[0].value + player[0].suit + " and dealer's up-card " +
      dealer[0].value + dealer[0].suit;

    document.getElementById("playerTotal").innerText = 
      "Your total: " + handTotal(player);
  }

  function hit() {
    if (gameOver) return;
    playerAction = "HIT";

    player.push(deck.pop());
    updateUI();

    if (handTotal(player) > 21) {
      endGame();
    }
  }

  function stand() {
    if (gameOver) return;
    playerAction = "STAND";
    dealerPlays();
  }

  function dealerPlays() {
    while (handTotal(dealer) < 17) {
      dealer.push(deck.pop());
    }
    endGame();
  }

  function endGame() {
    gameOver = true;

    // Reveal dealer hand
    const d = document.getElementById("dealerHand");
    d.innerHTML = "";
    dealer.forEach(c => d.appendChild(renderCard(c)));

    document.getElementById("dealerTotal").innerText = 
      "Total: " + handTotal(dealer);

    let pt = handTotal(player);
    let dt = handTotal(dealer);
    let result = "";

    if (pt > 21) result = "You Busted!";
    else if (dt > 21) result = "Dealer Busts! You Win!";
    else if (pt > dt) result = "You Win!";
    else if (dt > pt) result = "Dealer Wins!";
    else result = "Push (Tie)";

    document.getElementById("result").innerText = result;

    showStrategyExplanation(pt, dt);
  }

  // Basic strategy engine (very simplified)
  function correctMove(playerCards, dealerCard) {
    const total = handTotal(playerCards);
    const up = cardValue(dealerCard);

    // Always hit:
    if (total <= 11) return "HIT";

    // 12–16 rules
    if (total >= 12 && total <= 16) {
      if (up >= 7) return "HIT";
      return "STAND";
    }

    // 17+
    if (total >= 17) return "STAND";

    return "STAND";
  }

  function showStrategyExplanation(pt, dt) {
    const expected = correctMove(player, dealer[0]);
    let wasCorrect = (playerAction === expected);

    let text =
      `<p><strong>Your chosen move:</strong> ${playerAction}</p>
       <p><strong>Correct Basic Strategy:</strong> ${expected}</p>
       <p><strong>Were you correct?</strong> ${
         wasCorrect ? "<span style='color:lightgreen'>YES</span>" :
                       "<span style='color:pink'>NO</span>"
       }</p>
       <p>Your final total: ${pt}<br>
       Dealer final total: ${dt}</p>`;

    document.getElementById("rulesText").innerHTML = text;

    // Make box visible
    document.getElementById("rulesContainer").style.display = "block";
  }

  function restart() {
    gameOver = false;
    playerAction = null;
    document.getElementById("result").innerText = "";
    document.getElementById("rulesContainer").style.display = "none";
    createDeck();
    dealInitial();
  }

  function toggleRules() {
    const body = document.getElementById("rulesBody");
    const plus = document.getElementById("plusSign");

    if (body.classList.contains("open")) {
      body.classList.remove("open");
      plus.innerText = "+";
    } else {
      body.classList.add("open");
      plus.innerText = "-";
    }
  }

  // START GAME
  createDeck();
  dealInitial();
</script>

</body>
</html>